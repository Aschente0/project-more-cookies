{"version":3,"file":"static/webpack/static\\development\\pages\\watcher.js.801a8dab3b83a0cd379a.hot-update.js","sources":["webpack:///./pages/watcher.js"],"sourcesContent":["import { Component } from 'react';\r\nimport io from 'socket.io-client';\r\nimport { render } from 'react-dom';\r\nimport Router from 'next/router';\r\nimport Auth from '../lib/Auth';\r\n\r\n/***** help from https://github.com/Basscord/webrtc-video-broadcast *****/\r\n\r\nconst auth = new Auth();\r\n\r\nexport default class Watcher extends Component {\r\n    constructor(props){\r\n        super(props);\r\n\r\n        this.state={\r\n            broadcasters: []\r\n        }\r\n    }\r\n\r\n    componentDidMount(){\r\n        var user_data = localStorage.getItem('user_details');\r\n        var isLoggedIn = localStorage.getItem('isLoggedIn');\r\n        if(!isLoggedIn || !user_data){\r\n            window.location.replace('/');\r\n        }\r\n\r\n        this.socket=io('/stream');\r\n\r\n        let peerConnection;\r\n        let video = document.getElementById('video');\r\n\r\n        this.socket.on('offer', (id, message) => {\r\n            console.log(\"11) WATCHER RECEIVES offer\");\r\n            const peerConnection = new RTCPeerConnection();\r\n            peerConnection.setRemoteDescription(message)\r\n                .then(() => peerConnection.createAnswer())\r\n                .then(sdp => peerConnection.setLocalDescription(sdp))\r\n                .then(() => {\r\n                    console.log(\"WATCHER EMITS answer\");\r\n                    this.socket.emit('answer', id, peerConnection.localDescription);\r\n                });\r\n            peerConnection.ontrack = function(event) {\r\n                console.log(\"MOUNT VIDEO, STREAMS: \" + event.streams[0] + \" ACTIVE: \" + event.streams[0].active);\r\n                document.getElementById('video').srcObject = event.streams[0];\r\n            }\r\n        });\r\n\r\n        this.socket.on('connect', () => {\r\n            this.socket.emit('watcher');\r\n        });\r\n        \r\n        this.socket.on('broadcaster', () => {\r\n            console.log(\"3) WATCHER RECEIVES broadcaster AND EMITS watcher\");\r\n            this.socket.emit('watcher');\r\n        });\r\n\r\n        this.socket.on('stream_choice', (broadcasters) => {\r\n            console.log(\"5) WATCHER CHOOSING STREAM\");\r\n            console.log(Object.keys(broadcasters));\r\n\r\n            let pickstream = document.getElementById('pickstream');\r\n            Object.keys(broadcasters).forEach( (broadcast) => {\r\n                console.log(\"BROADCASTER: \" + broadcast);\r\n                pickstream.innerHTML = pickstream.innerHTML + `<button id=\"${broadcast}\">${broadcast}</button>`;\r\n\r\n            });\r\n\r\n            Object.keys(broadcasters).forEach( (broadcast) => {\r\n                document.getElementById(broadcast).addEventListener(\"click\", () => {\r\n                    console.log(\"6) WATCHER HAS CHOSEN A STREAM\");\r\n                    this.socket.emit('stream_chosen', broadcast);\r\n                });\r\n            });\r\n        });\r\n\r\n        this.socket.on('dc', () => {\r\n            console.log(\"WATCHER RECEIVED DISCONNECT\");\r\n            peerConnection.close();\r\n        });\r\n\r\n        Router.beforePopState(({url, as, options}) => {\r\n            console.log(\"ATTEMPTING TO DISCONNECT AS WATCHER\");\r\n            if(as !== \"/\" || as !== \"/other\") {\r\n                window.location.href = as;\r\n                return false;\r\n            };\r\n        });\r\n\r\n    }\r\n    render(){\r\n        return(\r\n            <div>\r\n                <video id=\"video\" width=\"640\" height=\"480\" autoPlay >\r\n                </video>\r\n                <div id=\"pickstream\">\r\n                </div>\r\n            </div>\r\n            \r\n        )\r\n    }\r\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AAEA;AACA;AADA;AAHA;AAMA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;;;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAKA;;;;AAzFA;AACA;;;;;A","sourceRoot":""}